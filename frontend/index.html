<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Simple Login</title>
</head>
<body>
<h2>Login</h2>
<form id="loginForm">
    <input type="email" id="email" placeholder="Email" required><br><br>
    <input type="password" id="password" placeholder="Password" required><br><br>
    <button type="submit">Login</button>
</form>

<h2>User Info</h2>
<pre id="userInfo"></pre>

<script>
    const loginForm = document.getElementById("loginForm");
    const userInfo = document.getElementById("userInfo");

    loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        try {
            // 1️⃣ Login API
            const loginResponse = await fetch("http://localhost:3000/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            const loginData = await loginResponse.json();

            if (!loginData.success) {
                alert(loginData.message || loginData.error);
                return;
            }

            const token = loginData.token;
            console.log("JWT Token:", token);

            // Optionally store token in localStorage
            localStorage.setItem("token", token);

            // 2️⃣ Fetch /user/me using token
            const meResponse = await fetch("http://localhost:3000/user/me", {
                headers: { "Authorization": `Bearer ${token}` }
            });

            const meData = await meResponse.json();
            if (meData.success) {
                userInfo.textContent = JSON.stringify(meData.user, null, 2);
            } else {
                userInfo.textContent = meData.message || "Error fetching user";
            }

        } catch (err) {
            console.error(err);
            alert("Something went wrong");
        }
    });
</script>
</body>
</html>
